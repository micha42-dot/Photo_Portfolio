<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Michael Förtsch | Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500&family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        black: '#0a0a0a',
                        gray: { 50: '#f9fafb', 100: '#f3f4f6', 900: '#111827' }
                    }
                }
            }
        }
    </script>
    <style>
        /* CSS Grid Masonry Fallback - Stabil und schnell */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1.5rem;
        }
        @media (min-width: 640px) { .gallery-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .gallery-grid { grid-template-columns: repeat(3, 1fr); } }

        /* Performance Optimierungen */
        .img-container {
            background-color: #f3f4f6;
            overflow: hidden;
            position: relative;
        }
        
        .gallery-img {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            width: 100%;
            height: auto;
            display: block;
        }
        
        .gallery-img.loaded {
            opacity: 1;
        }

        /* Navigation Active State */
        .nav-link.active { color: black; font-weight: 500; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.3",
    "react/": "https://esm.sh/react@^19.2.4/",
    "vite": "https://esm.sh/vite@^7.3.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-white text-gray-900 flex flex-col min-h-screen">

    <!-- HEADER -->
    <header class="fixed top-0 w-full bg-white/95 backdrop-blur-md z-40 border-b border-gray-100 transition-all duration-300" id="main-header">
        <div class="max-w-[1800px] mx-auto px-6 h-20 flex items-center justify-between">
            
            <!-- Logo -->
            <a href="#" onclick="app.filter('all')" class="font-display font-bold text-lg md:text-xl tracking-[0.15em] uppercase hover:opacity-60 transition-opacity">
                Michael Förtsch
            </a>

            <!-- Desktop Nav -->
            <nav class="hidden md:flex items-center gap-8">
                <!-- Kategorien werden hier per JS eingefügt -->
                <div id="desktop-categories" class="flex gap-6"></div>
                
                <div class="h-4 w-[1px] bg-gray-300 mx-2"></div>
                
                <a href="info.html" class="text-xs font-display font-medium tracking-[0.15em] uppercase text-gray-400 hover:text-black transition-colors">
                    Info
                </a>
            </nav>

            <!-- Mobile Menu Toggle -->
            <button class="md:hidden p-2 -mr-2 text-black" onclick="app.toggleMobileMenu()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>
    </header>

    <!-- MOBILE MENU -->
    <div id="mobile-menu" class="fixed inset-0 bg-white z-50 transform translate-x-full transition-transform duration-300 flex flex-col p-8">
        <div class="flex justify-end mb-8">
            <button onclick="app.toggleMobileMenu()" class="p-2">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <nav id="mobile-nav-items" class="flex flex-col gap-6 text-xl font-display font-light uppercase tracking-widest text-center">
            <!-- Items via JS -->
        </nav>
        <a href="info.html" class="mt-8 text-center text-xl font-display font-light uppercase tracking-widest text-gray-400">Info & Kontakt</a>
    </div>

    <!-- MAIN GALLERY -->
    <main class="flex-grow pt-32 pb-20 px-4 md:px-8 w-full max-w-[1800px] mx-auto">
        <div id="gallery-container" class="gallery-grid">
            <!-- Bilder werden hier eingefügt -->
        </div>
        
        <!-- Loading Sentinel / Status -->
        <div id="loading-trigger" class="h-24 w-full flex items-center justify-center mt-12 opacity-0 transition-opacity">
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce mx-1"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce mx-1 delay-100"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce mx-1 delay-200"></div>
        </div>
        
        <div id="end-message" class="hidden text-center py-12 text-gray-400 text-xs tracking-widest uppercase">
            Ende der Galerie
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="border-t border-gray-100 bg-gray-50 py-16 text-center">
        <h3 class="font-display font-bold tracking-widest uppercase mb-4 text-lg">Journalismus</h3>
        <p class="text-gray-500 font-light mb-8 max-w-md mx-auto px-4">
            Technologie- und Wissenschaftsjournalismus.
        </p>
        <a href="https://michaelfoertsch.de" target="_blank" class="inline-block border border-black px-8 py-3 text-xs font-bold tracking-widest uppercase hover:bg-black hover:text-white transition-colors">
            Zur Website
        </a>
        <div class="mt-16 text-[10px] text-gray-400 font-display tracking-widest">
            &copy; <span id="year"></span> MICHAEL FÖRTSCH.
        </div>
    </footer>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="fixed inset-0 z-50 bg-white/98 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <button onclick="app.closeLightbox()" class="absolute top-6 right-6 p-4 hover:opacity-50 transition-opacity z-50">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        
        <button onclick="app.prevImage()" class="absolute left-4 top-1/2 -translate-y-1/2 p-4 hover:opacity-50 transition-opacity hidden md:block">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        
        <button onclick="app.nextImage()" class="absolute right-4 top-1/2 -translate-y-1/2 p-4 hover:opacity-50 transition-opacity hidden md:block">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5l7 7-7 7"></path></svg>
        </button>

        <img id="lightbox-img" class="max-w-[95vw] max-h-[90vh] object-contain shadow-2xl" src="" alt="">
        <div id="lightbox-caption" class="absolute bottom-6 left-0 right-0 text-center font-display text-xs tracking-widest uppercase text-gray-500"></div>
    </div>

    <!-- DATA -->
    <script src="data.js"></script>

    <!-- APP LOGIC -->
    <script>
        // Namespacing zur Vermeidung von globalen Konflikten
        const app = {
            data: [],
            currentImages: [],
            renderedCount: 0,
            batchSize: 15, // Konservativ für Firefox
            lightboxIndex: 0,
            observer: null,
            currentCategory: 'all',

            init: function() {
                if(!window.portfolioData) {
                    console.error("Keine Daten gefunden. Bitte 'npm run scan' ausführen.");
                    return;
                }
                this.data = window.portfolioData;
                document.getElementById('year').textContent = new Date().getFullYear();

                this.setupNavigation();
                this.setupObserver();
                this.filter('all'); // Start mit allen Bildern
                
                // Keyboard Events für Lightbox
                document.addEventListener('keydown', (e) => {
                    if (document.getElementById('lightbox').classList.contains('opacity-0')) return;
                    if (e.key === 'Escape') this.closeLightbox();
                    if (e.key === 'ArrowRight') this.nextImage();
                    if (e.key === 'ArrowLeft') this.prevImage();
                });
            },

            setupNavigation: function() {
                const deskNav = document.getElementById('desktop-categories');
                const mobNav = document.getElementById('mobile-nav-items');
                
                // "Alle" Link
                const allLink = this.createNavLink('all', 'Alle');
                deskNav.appendChild(allLink);
                mobNav.appendChild(this.createMobileLink('all', 'Alle'));

                // Kategorien Links
                this.data.forEach(cat => {
                    const link = this.createNavLink(cat.id, cat.label);
                    deskNav.appendChild(link);
                    mobNav.appendChild(this.createMobileLink(cat.id, cat.label));
                });
            },

            createNavLink: function(id, label) {
                const btn = document.createElement('button');
                btn.textContent = label;
                btn.className = `text-xs font-display font-medium tracking-[0.15em] uppercase text-gray-400 hover:text-black transition-colors nav-link`;
                btn.dataset.id = id;
                btn.onclick = () => this.filter(id);
                return btn;
            },

            createMobileLink: function(id, label) {
                const btn = document.createElement('button');
                btn.textContent = label;
                btn.onclick = () => { this.filter(id); this.toggleMobileMenu(); };
                return btn;
            },

            filter: function(catId) {
                this.currentCategory = catId;
                this.renderedCount = 0;
                document.getElementById('gallery-container').innerHTML = ''; // Reset Grid
                document.getElementById('end-message').classList.add('hidden');
                
                // Active State Update
                document.querySelectorAll('.nav-link').forEach(btn => {
                    if(btn.dataset.id === catId) btn.classList.add('active', 'text-black');
                    else btn.classList.remove('active', 'text-black');
                });

                // Daten filtern
                if (catId === 'all') {
                    // Alle Bilder flatten
                    this.currentImages = this.data.flatMap(cat => 
                        cat.images.map(src => ({ src: src, title: this.formatTitle(src) }))
                    );
                    // Shuffle für "Alle" (optional, sieht aber besser aus)
                    this.currentImages.sort(() => Math.random() - 0.5);
                } else {
                    const category = this.data.find(c => c.id === catId);
                    if(category) {
                        this.currentImages = category.images.map(src => ({ src: src, title: this.formatTitle(src) }));
                    } else {
                        this.currentImages = [];
                    }
                }

                this.loadMore();
                window.scrollTo({top: 0, behavior: 'smooth'});
            },

            loadMore: function() {
                const container = document.getElementById('gallery-container');
                const trigger = document.getElementById('loading-trigger');
                
                if (this.renderedCount >= this.currentImages.length) {
                    trigger.classList.remove('opacity-100');
                    document.getElementById('end-message').classList.remove('hidden');
                    return;
                }

                trigger.classList.add('opacity-100');

                const nextBatch = this.currentImages.slice(this.renderedCount, this.renderedCount + this.batchSize);
                const fragment = document.createDocumentFragment();

                nextBatch.forEach((imgData, index) => {
                    // Globaler Index für Lightbox
                    const globalIndex = this.renderedCount + index;

                    const div = document.createElement('div');
                    div.className = 'img-container group cursor-pointer';
                    div.onclick = () => this.openLightbox(globalIndex);

                    const img = document.createElement('img');
                    img.className = 'gallery-img';
                    img.alt = imgData.title;
                    img.loading = "lazy"; // Native Lazy Loading
                    img.decoding = "async"; // Wichtig für Performance
                    
                    // URL Encoding Fix
                    const encodedSrc = imgData.src.split('/').map(encodeURIComponent).join('/');
                    img.src = encodedSrc;

                    img.onload = () => img.classList.add('loaded');
                    img.onerror = () => div.style.display = 'none'; // Kaputte Bilder verstecken

                    // Hover Overlay
                    const overlay = document.createElement('div');
                    overlay.className = "absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300";

                    div.appendChild(img);
                    div.appendChild(overlay);
                    fragment.appendChild(div);
                });

                // RequestAnimationFrame verhindert Blockieren des Main Threads
                requestAnimationFrame(() => {
                    container.appendChild(fragment);
                    this.renderedCount += nextBatch.length;
                    trigger.classList.remove('opacity-100');
                });
            },

            setupObserver: function() {
                const options = { root: null, rootMargin: '400px', threshold: 0.1 };
                this.observer = new IntersectionObserver((entries) => {
                    if(entries[0].isIntersecting) {
                        this.loadMore();
                    }
                }, options);
                this.observer.observe(document.getElementById('loading-trigger'));
            },

            // --- LIGHTBOX ---
            openLightbox: function(index) {
                this.lightboxIndex = index;
                this.updateLightbox();
                const lb = document.getElementById('lightbox');
                lb.classList.remove('opacity-0', 'pointer-events-none');
                document.body.style.overflow = 'hidden';
            },

            closeLightbox: function() {
                const lb = document.getElementById('lightbox');
                lb.classList.add('opacity-0', 'pointer-events-none');
                document.body.style.overflow = '';
                setTimeout(() => { document.getElementById('lightbox-img').src = ''; }, 300);
            },

            updateLightbox: function() {
                const data = this.currentImages[this.lightboxIndex];
                if(!data) return;
                
                const img = document.getElementById('lightbox-img');
                const caption = document.getElementById('lightbox-caption');
                
                // Sauber laden
                const tempImg = new Image();
                tempImg.onload = () => { img.src = tempImg.src; };
                tempImg.src = data.src.split('/').map(encodeURIComponent).join('/');
                
                caption.textContent = data.title;
            },

            nextImage: function() {
                this.lightboxIndex = (this.lightboxIndex + 1) % this.currentImages.length;
                this.updateLightbox();
            },

            prevImage: function() {
                this.lightboxIndex = (this.lightboxIndex - 1 + this.currentImages.length) % this.currentImages.length;
                this.updateLightbox();
            },

            // --- HELPER ---
            toggleMobileMenu: function() {
                const menu = document.getElementById('mobile-menu');
                menu.classList.toggle('translate-x-full');
            },

            formatTitle: function(pathStr) {
                const filename = pathStr.split('/').pop().split('.')[0];
                // Entfernt Nummernklammern wie (1) und Unterstriche
                return filename.replace(/[\(\)\d_-]/g, ' ').trim();
            }
        };

        // Start
        window.addEventListener('DOMContentLoaded', () => app.init());

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>